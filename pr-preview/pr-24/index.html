<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuu's Presentations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="index.css">
    <script type="module" src="components/index.js"></script>
</head>
<body class="h-full bg-white dark:bg-gray-900 transition-colors duration-200">
    <div class="min-h-full flex flex-col">
        <header-component>
            <span slot="title">Kuu's Presentations</span>
            <div slot="social-links">
                <a href="https://x.com/Fumiya_Kume" 
                   class="social-link"
                   title="Follow on X (Twitter)"
                   target="_blank"
                   rel="noopener noreferrer">
                    <i class="fab fa-x-twitter"></i>
                </a>
                <a href="https://www.linkedin.com/in/kuu-sushi/" 
                   class="social-link"
                   title="Connect on LinkedIn"
                   target="_blank"
                   rel="noopener noreferrer">
                    <i class="fab fa-linkedin"></i>
                </a>
            </div>
        </header-component>

        <main class="flex-grow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <loading-states state="loading">
                    <div slot="loading-text" class="loading-indicator">
                        <i class="fas fa-circle-notch fa-spin fa-2x text-gray-600 dark:text-gray-400"></i>
                        <p class="loading-text">Loading presentations...</p>
                    </div>
                    <div slot="error-message" class="error-container">
                        <i class="fas fa-exclamation-circle fa-2x"></i>
                        <p class="error-message">Failed to load presentations</p>
                        <button slot="error-action" onclick="loadPresentations()" 
                                class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
                            Retry
                        </button>
                    </div>
                    <div slot="empty-message" class="empty-container">
                        <i class="fas fa-inbox fa-2x mb-4"></i>
                        <p>No presentations found</p>
                    </div>
                </loading-states>

                <div id="presentationGrid" class="hidden">
                    <!-- Presentations will be dynamically inserted here -->
                </div>
            </div>
        </main>

        <footer-component></footer-component>
    </div>

    <script>
        // Utility function to escape HTML
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Presentation loading and rendering logic
        async function loadPresentations() {
            const loadingStates = document.querySelector('loading-states');
            const presentationGrid = document.getElementById('presentationGrid');
            
            try {
                loadingStates.setAttribute('state', 'loading');
                presentationGrid.classList.add('hidden');

                // Try loading from the current directory first
                let response = await fetch('pr-preview/24/metadata.json');
                
                // If that fails, try the GitHub Pages path
                if (!response.ok && window.location.hostname.includes('github.io')) {
                    const basePath = window.location.pathname.split('/')[1]; // Should be 'presentation'
                    response = await fetch(`/${basePath}/pr-preview/24/metadata.json`);
                }

                if (!response.ok) throw new Error('Failed to load presentations');
                
                const data = await response.json();
                if (!data.presentations || data.presentations.length === 0) {
                    loadingStates.setAttribute('state', 'empty');
                    return;
                }

                // Sort presentations by last modified date
                const sortedPresentations = data.presentations.sort(
                    (a, b) => new Date(b.lastModified) - new Date(a.lastModified)
                );

                renderPresentations(sortedPresentations);
                loadingStates.classList.add('hidden');
                presentationGrid.classList.remove('hidden');
            } catch (error) {
                console.error('Error loading presentations:', error);
                loadingStates.setAttribute('state', 'error');
            }
        }

        function renderPresentations(presentations) {
            const grid = document.getElementById('presentationGrid');
            grid.innerHTML = presentations.map(presentation => `
                <presentation-card
                    title="${escapeHtml(presentation.title)}"
                    description="${escapeHtml(presentation.description)}"
                    path="${escapeHtml(presentation.path)}"
                    last-modified="${presentation.lastModified}"
                    html-url="${escapeHtml(presentation.formats.html)}"
                    pdf-url="${escapeHtml(presentation.formats.pdf)}"
                ></presentation-card>
            `).join('');
        }

        // Load presentations when the page loads
        document.addEventListener('DOMContentLoaded', loadPresentations);
    </script>
</body>
</html> 